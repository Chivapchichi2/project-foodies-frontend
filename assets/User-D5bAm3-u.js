import{j as e,Y as E,k as h,x as q,z as ne,a0 as ce,N as H,M as A,$ as J,a1 as le,A as pe,u as V,B as z,F as X,r as _,a2 as de,a3 as ue,a4 as fe,a5 as _e,a6 as D,a7 as me,L as he,a8 as ge,a9 as xe,w as G,v as we,aa as ve,ab as je,ac as be,W as Ce,ad as ye,ae as Ne,af as Fe,_ as R,C as Pe,ag as Le,ah as Y}from"./index-D1B0M72U.js";import{s as Z,a as B,b as K,c as Ie,d as Re}from"./profileSelectors-DjL7l0TR.js";import{S as Ue}from"./SectionTitle-C7wQrdzk.js";import{B as We}from"./BreadCrumbs-BkC7MaJE.js";const Se="_container_1nv0s_1",Te="_content_1nv0s_13",Ae="_message_1nv0s_21",C={container:Se,content:Te,message:Ae},Ee="_menuContainer_gij54_1",Be="_menuItem_gij54_29",Oe="_active_gij54_75",k={menuContainer:Ee,menuItem:Be,active:Oe},ke=({menuItems:s,activeTab:o,setActiveTab:t})=>e.jsx("div",{className:k.menuContainer,children:s.map(a=>e.jsx("div",{className:`${k.menuItem} ${a.id===o?k.active:""}`,onClick:()=>t(a.id),children:a.label},a.id))}),$e="_recipeCard_zbyhy_1",Me={recipeCard:$e},ee=({imgUrl:s,title:o})=>e.jsx("div",{className:Me.recipeCard,children:e.jsx("img",{src:s,alt:o})}),ze="_recipeCardWrapper_avu2p_1",De="_flexPhotoWrapper_avu2p_11",Qe="_recipeTextWrapper_avu2p_21",Ve="_recipeInstructions_avu2p_29",Ge="_recipeTitle_avu2p_51",Ye="_buttonWrapper_avu2p_67",qe="_recipeCardList_avu2p_77",He="_iconBtn_avu2p_89",Je="_icon_avu2p_89",x={recipeCardWrapper:ze,flexPhotoWrapper:De,recipeTextWrapper:Qe,recipeInstructions:Ve,recipeTitle:Ge,buttonWrapper:Ye,recipeCardList:qe,iconBtn:He,icon:Je},Xe=({data:s,tab:o})=>{const t=E(),a=h(q),n=h(Z),p=h(B),[u]=ne(),[c]=ce(),d=()=>{o==="recipe"?(t(J(n.filter(i=>i._id!==s._id))),c(s._id)):(t(le(a.filter(i=>i!==s._id))),pe(u,s._id,"delete"))};return e.jsxs("li",{className:x.recipeCardWrapper,children:[e.jsxs("div",{className:x.flexPhotoWrapper,children:[e.jsx(ee,{imgUrl:s.thumb,title:s.title}),e.jsxs("div",{className:x.recipeTextWrapper,children:[e.jsxs("h5",{className:x.recipeTitle,children:[" ",s.title," "]}),e.jsx("p",{className:x.recipeInstructions,children:s.instructions})]})]}),e.jsxs("div",{className:x.buttonWrapper,children:[e.jsx(H,{to:`/recipe/${s._id}`,children:e.jsx(A,{iconId:"icon-arrow-up-right",style:x.iconBtn,styleSVG:x.icon})}),p&&e.jsx(A,{iconId:"icon-trash",onClick:d,style:x.iconBtn,styleSVG:x.icon})]})]})},$=({data:s,tab:o})=>e.jsx("ul",{className:x.recipeCardList,children:s.map(t=>e.jsx(Xe,{data:t,tab:o},t._id))}),Ze="_cardWrapper_bt2lx_1",Ke="_photoWrapper_bt2lx_15",es="_smallProfilePhoto_bt2lx_41",ss="_followerData_bt2lx_51",ts="_name_bt2lx_61",rs="_descr_bt2lx_77",os="_followerCardList_bt2lx_91",as="_iconBtn_bt2lx_99",is="_icon_bt2lx_99",ns="_recipesList_bt2lx_157",cs="_recipeCard_bt2lx_167",w={cardWrapper:Ze,photoWrapper:Ke,smallProfilePhoto:es,followerData:ss,name:ts,descr:rs,followerCardList:os,iconBtn:as,icon:is,recipesList:ns,recipeCard:cs},ls=({data:s,tab:o,handleFollowUser:t,handleUnfollowUser:a})=>{var c;const n=V(768,!1,3),p=V(1440,3,4),u=()=>{if(o==="followers")return s.isFollowing?"unfollow":"follow";if(o==="following")return"unfollow"};return e.jsxs("li",{className:w.cardWrapper,children:[e.jsxs("div",{className:w.followerData,children:[e.jsx("div",{className:w.photoWrapper,children:e.jsx("img",{src:s.avatarURL||"https://gravatar.com/avatar/000000000000000000000000000000000000000000000000000000?d=mp",className:w.smallProfilePhoto,alt:"User avatar"})}),e.jsxs("div",{children:[e.jsxs("h5",{className:w.name,children:[" ",s.name]}),e.jsxs("p",{className:w.descr,children:["Own recipes: ",s.totalRecipes]}),e.jsx(z,{text:u(),variant:"follow_user",onClick:()=>u()==="follow"?t(s._id):a(s._id)})]})]}),n&&e.jsx("ul",{className:w.recipesList,children:(c=s==null?void 0:s.recipes)==null?void 0:c.map((d,i)=>{if(i<p)return e.jsx("li",{children:e.jsx(ee,{imgUrl:d.thumb,title:d.title})},d._id)})}),e.jsx(H,{to:`/user/${s._id}`,children:e.jsx(A,{iconId:"icon-arrow-up-right",style:w.iconBtn,styleSVG:w.icon})})]})},M=({data:s,tab:o,handleFollowUser:t,handleUnfollowUser:a})=>e.jsx("ul",{className:w.followerCardList,children:s.map(n=>e.jsx(ls,{data:n,tab:o,handleFollowUser:t,handleUnfollowUser:a},n._id))}),y=[{id:"my-recipes",label:"MY RECIPES",message:"Nothing has been added to your recipes list yet. Please browse our recipes and add your favorites for easy access in the future."},{id:"my-favorites",label:"MY FAVORITES",message:"Nothing has been added to your favorite recipes list yet. Please browse our recipes and add your favorites for easy access in the future."},{id:"followers",label:"FOLLOWERS",message:"There are currently no followers on your account. Please engage our visitors with interesting content and draw their attention to your profile."},{id:"following",label:"FOLLOWING",message:"Your account currently has no subscriptions to other users. Learn more about our users and select those whose content interests you."}],U=[{id:"recipes",label:"RECIPES",message:"The current user hasn't added any recipes yet."},{id:"followers",label:"FOLLOWERS",message:"The current user hasn't any followers yet."}],ps=({handleFollowUser:s,handleUnfollowUser:o})=>{const{id:t}=X(),a=E(),n=h(B),p=h(K),u=h(Ie),c=h(Z),d=h(q),[i,j]=_.useState(1),[m,b]=_.useState(0),[r,g]=_.useState(n?y[0].id:U[0].id),{data:l,isLoading:N}=de({userId:t,page:i},{skip:r!=="my-recipes"&&r!=="recipes"});_.useEffect(()=>{j(1)},[r]);const W=({selected:P})=>{j(P+1)};_.useEffect(()=>{g(n?y[0].id:U[0].id)},[n]);const{data:f,isLoading:I}=ue({page:i,limit:10,skip:r!=="my-favorites"}),{data:S,isLoading:se}=fe({userId:t,page:i,skip:r!=="followers"}),{data:T,isLoading:te}=_e({skip:r!=="following",page:i}),re=N||I||se||te;_.useEffect(()=>{l&&!N&&(b(l.totalPages),a(J(l.data))),r==="followers"&&S?(b(S.totalPages),a(D(S.followersWithRecipes))):r==="following"&&T?(b(T.totalPages),a(me(T.followingWithRecipes))):r==="my-favorites"&&f&&b(f.totalPages)},[r,a,S,T,f,N,l,i,d]);const F=(P,O)=>P.find(({id:ie})=>ie===O).message,oe=()=>{var P;if(n)switch(r){case"my-recipes":return(c==null?void 0:c.length)>0?e.jsx($,{data:c,tab:"recipe"}):e.jsx("p",{className:C.message,children:F(y,r)});case"my-favorites":if(((P=f.data)==null?void 0:P.length)>0){const O=f==null?void 0:f.data.map(Q=>Q.recipe);return e.jsx($,{data:O,tab:"favorites"})}else return e.jsx("p",{className:C.message,children:F(y,r)});case"followers":return(p==null?void 0:p.length)>0?e.jsx(M,{handleFollowUser:s,handleUnfollowUser:o,data:p,tab:"followers"}):e.jsx("p",{className:C.message,children:F(y,r)});case"following":return(u==null?void 0:u.length)>0?e.jsx(M,{handleFollowUser:s,handleUnfollowUser:o,data:u,tab:"following"}):e.jsx("p",{className:C.message,children:F(y,r)});default:return null}else switch(r){case"recipes":return(l==null?void 0:l.total)>0?e.jsx($,{data:l.data}):e.jsx("p",{className:C.message,children:F(U,r)});case"followers":return(p==null?void 0:p.length)>0?e.jsx(M,{handleFollowUser:s,handleUnfollowUser:o,data:p,tab:"followers"}):e.jsx("p",{className:C.message,children:F(U,r)});default:return null}},ae=n?y:U;return e.jsxs("div",{className:C.container,children:[e.jsx(ke,{menuItems:ae,activeTab:r,setActiveTab:g}),re?e.jsx(he,{}):e.jsx("div",{className:C.content,children:oe()}),m>1&&e.jsx(ge,{pageCount:m,onPageChange:W,currentPage:i})]})},ds="_container_1ivx6_1",us="_breadscrumbs_1ivx6_9",fs="_title_1ivx6_17",_s="_subtitle_1ivx6_23",ms="_userInfoAndBtnWrapper_1ivx6_41",hs="_userInfoAndTabContentWerapper_1ivx6_111",L={container:ds,breadscrumbs:us,title:fs,subtitle:_s,userInfoAndBtnWrapper:ms,userInfoAndTabContentWerapper:hs},gs="_profile_card_wrapper_1iacj_1",xs="_profile_card_1iacj_1",ws="_profile_name_1iacj_43",vs="_profile_card_info_1iacj_61",js="_profile_info_item_1iacj_75",bs="_profile_info_content_1iacj_95",Cs="_profile_big_card_button_1iacj_111",ys="_profile_big_card_icon_1iacj_129",Ns="_profile_photo_1iacj_137",v={profile_card_wrapper:gs,profile_card:xs,profile_name:ws,profile_card_info:vs,profile_info_item:js,profile_info_content:bs,profile_big_card_button:Cs,profile_big_card_icon:ys,profile_photo:Ns},Fs=s=>s.charAt(0).toUpperCase()+s.slice(1),Ps=({name:s,value:o})=>{const t={email:"email",createdRecipesCount:"added recipes",favoriteRecipesCount:"favorites",followersCount:"followers",followingCount:"following"};return e.jsxs("li",{className:v.profile_info_item,children:[Fs(t[s]),":",e.jsx("span",{className:v.profile_info_content,children:o})]})},Ls=()=>{const s=h(B),[o]=xe(),t=h(Re),a=E(),n=t?Object.keys(t):[],[p,u]=_.useState((t==null?void 0:t.avatar)||G),c=async r=>{const g=new FormData;g.append("avatar",r);try{const l=await o(g).unwrap();u(l.avatarURL),a(ve(l.avatarURL))}catch(l){console.error("Error updating avatar:",l)}},d=r=>{const g=r.target.files[0];if(g){const l=new FileReader;l.onload=()=>{c(g)},l.readAsDataURL(g)}},i=_.useRef(null),[j,m]=_.useState({width:16,height:16}),b=()=>{i.current.click()};return _.useEffect(()=>{u((t==null?void 0:t.avatar)||G)},[t==null?void 0:t.avatar]),_.useEffect(()=>{const r=()=>{window.matchMedia("(max-width: 768px)").matches?m({width:16,height:16}):m({width:18,height:18})};return r(),window.addEventListener("resize",r),()=>{window.removeEventListener("resize",r)}},[]),e.jsx("div",{className:v.profile_card_wrapper,children:e.jsxs("div",{className:v.profile_card,children:[e.jsx("img",{className:v.profile_photo,src:p,alt:`${(t==null?void 0:t.name)||"User Name"} avatar`}),s&&e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"file",ref:i,style:{display:"none"},onChange:d}),e.jsx(A,{iconId:"icon-plus",style:v.profile_big_card_button,styleSVG:v.profile_big_card_icon,stroke:"#FFF",width:j.width,height:j.height,onClick:b})]}),e.jsx("h3",{className:v.profile_name,children:t==null?void 0:t.name}),e.jsx("ul",{className:v.profile_info,children:n.map(r=>{if(!(r==="_id"||r==="name"||r==="avatar"))return e.jsx(Ps,{name:r,value:t[r]},we())})})]})})},Is="toastId",Ts=()=>{const s=h(je),[o,t]=_.useState(!1),[a,n]=_.useState(!1),p=h(B),u=h(K),{id:c}=X(),d=E(),{data:i,error:j}=be(c),{data:m}=Ce(),[b,{error:r}]=ye(),[g,{error:l}]=Ne(),N=f=>{if(b(f),r){R.error("Something went wrong",{position:"top-right"});return}d(Y({...m,following:[...m.following,f]})),d(D([...u])),n(!0),R.success("Follow successful",{position:"top-right"})},W=f=>{if(g(f),l){R.error("Something went wrong",{position:"top-right"});return}d(Y({...m,following:m.following.filter(I=>I!==f)})),d(D([...u])),n(!1),R.success("Unfollow successful",{position:"top-right"})};if(_.useEffect(()=>{if(c!==s&&m&&m.following){const f=m.following.some(I=>I===c);n(f)}},[m,c,s]),_.useEffect(()=>{i&&d(Fe(i))},[i,d]),j){R.error(j.data.message,{position:"top-right",toastId:Is});return}return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:L.container,children:[e.jsx("div",{className:L.breadscrumbs,children:e.jsx(We,{currentPage:"Profile"})}),e.jsx("div",{className:L.title,children:e.jsx(Ue,{text:"Profile"})}),e.jsxs("p",{className:L.subtitle,children:["Reveal your culinary art, share your favorite recipe and create ",e.jsx("br",{}),"gastronomic masterpieces with us."]}),e.jsxs("div",{className:L.userInfoAndTabContentWerapper,children:[e.jsxs("div",{className:L.userInfoAndBtnWrapper,children:[e.jsx(Ls,{}),p?e.jsx(z,{type:"button",variant:"logoutOrFollowBtn",text:"Log Out",onClick:()=>t(!0)}):e.jsx(z,{type:"button",variant:"logoutOrFollowBtn",text:a?"Unfollow":"Follow",onClick:a?()=>W(c):()=>N(c)})]}),e.jsx(ps,{handleFollowUser:N,handleUnfollowUser:W})]})]}),e.jsx(Pe,{isOpen:o,onClose:()=>t(!1),children:e.jsx(Le,{setModalLogOutOpen:t})})]})};export{Ts as default};
